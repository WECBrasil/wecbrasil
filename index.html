<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Serviços - WEC Brasil</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    .hidden { display: none; }
  </style>
</head>
<body class="p-4">
  <div class="container">
    <header class="mb-4 text-center">
      <div class="d-flex justify-content-center align-items-center mb-2">
        <img src="/logo.png" alt="Logo WEC Brasil" height="80" class="me-2">
        <span class="fs-2 fw-bold">WEC Brasil</span>
      </div>
      <h1 class="fs-4">Registro de Serviços</h1>
    </header>

    <!-- Trecho do Login (alterado) -->
<div class="card mb-4" id="loginCard">
  <div class="card-header">Login</div>
  <div class="card-body">
    <form id="formLogin">
      <input type="text" class="form-control mb-2" id="loginUsuario" placeholder="Email" required>
      <div class="input-group mb-2">
        <input type="password" class="form-control" id="loginSenha" placeholder="Senha" required>
      </div>
      <button type="submit" class="btn btn-primary">Entrar</button>
    </form>
    <div class="mt-3">
      <span>Não tem conta?</span>
      <button class="btn btn-link p-0" id="btnMostrarCadastro">Cadastre-se</button>
    </div>
    <!-- Novo botão Esqueceu a senha -->
    <div class="mt-2">
      <button class="btn btn-link p-0" id="btnEsqueceuSenha">Esqueceu a senha?</button>
    </div>
  </div>
</div>

    <!-- Cadastro individual -->
    <div class="card mb-4 hidden" id="cadastroIndividualCard">
      <div class="card-header">Cadastro de Novo Usuário</div>
      <div class="card-body">
        <form id="formCadastroIndividual">
          <input type="text" class="form-control mb-2" id="nomeCadastroIndividual" placeholder="Nome completo" required>
          <input type="email" class="form-control mb-2" id="emailCadastroIndividual" placeholder="Email" required>
          <div class="input-group mb-2">
            <input type="password" class="form-control" id="senhaCadastroIndividual" placeholder="Senha" required>
          </div>
          <button type="submit" class="btn btn-success">Cadastrar</button>
          <button type="button" class="btn btn-link" id="btnVoltarLogin">Voltar ao login</button>
        </form>
      </div>
    </div>

    <!-- Cadastro de usuários (somente para admin) -->
    <div class="card mb-4 hidden" id="cadastroCard">
      <div class="card-header">Cadastro de Usuário</div>
      <div class="card-body">
        <form id="formMissionario">
          <input type="text" class="form-control mb-2" id="nomeMissionario" placeholder="Nome do usuário" required>
          <input type="email" class="form-control mb-2" id="emailMissionario" placeholder="Email" required>
          <input type="password" class="form-control mb-2" id="senhaMissionario" placeholder="Senha" required>
          <select class="form-select mb-2" id="tipoUsuario">
            <option value="comum">Usuário</option>
            <option value="admin">Administrador</option>
          </select>
          <button type="submit" class="btn btn-primary">Cadastrar</button>
        </form>
      </div>
    </div>

    <!-- Alterar senha -->
    <div class="card mb-4 hidden" id="alterarSenhaCard">
      <div class="card-header">Alterar Senha</div>
      <div class="card-body">
        <form id="formAlterarSenha">
          <input type="password" class="form-control mb-2" id="senhaAtual" placeholder="Senha atual" required>
          <input type="password" class="form-control mb-2" id="novaSenha" placeholder="Nova senha" required>
          <button type="submit" class="btn btn-warning">Alterar Senha</button>
        </form>
      </div>
    </div>

    <!-- Registro de uso de serviços -->
    <div class="card mb-4 hidden" id="registroCard">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Registro de Uso</span>
        <div>
          <button class="btn btn-outline-secondary btn-sm" onclick="mostrarAlterarSenha()">Alterar Senha</button>
          <button class="btn btn-outline-danger btn-sm" onclick="logout()">Sair</button>
        </div>
      </div>
      <div class="card-body">
        <form id="formUso">
          <div class="mb-2"><strong>Usuário logado:</strong> <span id="usuarioLogado"></span></div>
          <label>Serviço:</label>
          <select id="tipoServico" class="form-select mb-2" required onchange="mostrarCamposServico()">
            <option value="">Selecione</option>
            <option value="lavanderia">Lavanderia</option>
            <option value="carro">Uso do Carro</option>
            <option value="copias">Cópias e Impressões</option>
            <option value="refeicoes">Refeições</option>
            <option value="hospedagem">Hospedagem</option>
          </select>
          <div id="detalhesServico" class="mb-3"></div>
          <button type="submit" class="btn btn-success">Registrar Uso</button>
        </form>
      </div>
    </div>

    <!-- Listagem de Registros -->
    <div class="card mb-4 hidden" id="listagemRegistrosCard">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Listagem de Registros</span>
        <small class="text-muted">Meus registros recentes</small>
      </div>
      <div class="card-body">
        <table class="table table-sm table-bordered" id="tabelaRegistros">
          <thead>
            <tr>
              <th style="width:120px">Data</th>
              <th>Tipo</th>
              <th>Detalhes</th>
              <th style="width:140px">Ações</th>
            </tr>
          </thead>
          <tbody id="listaRegistros">
            <tr>
              <td colspan="4" class="text-center text-muted">Carregando...</td>
            </tr>
          </tbody>
        </table>
        <div class="text-center mt-2">
          <button id="btnVerTodos" class="btn btn-outline-primary btn-sm hidden" type="button">
            Ver todos
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Edição Registro -->
<div class="modal fade" id="modalEditarRegistro" tabindex="-1" aria-labelledby="modalEditarRegistroLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalEditarRegistroLabel">Editar Registro</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <form id="formEditarRegistro">
          <input type="hidden" id="edit-id">
          <div id="camposEdicaoServico"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" onclick="salvarEdicao()">Salvar</button>
      </div>
    </div>
  </div>
</div>

    <!-- Relatório Geral (apenas para admin ou quem tem liberação) -->
<div class="card hidden" id="relatorioCard">
  <div class="card-header">Relatório Atual</div>
  <div class="mb-3 d-flex gap-2 flex-wrap">
    <div>
      <label for="dataInicial" class="form-label">De:</label>
      <input type="date" class="form-control" id="dataInicial">
    </div>
    <div>
      <label for="dataFinal" class="form-label">Até:</label>
      <input type="date" class="form-control" id="dataFinal">
    </div>
  </div>
  <div class="card-body">
    <button class="btn btn-info" onclick="gerarRelatorio()">Gerar Relatório</button>
    <div class="mt-2">
      <button onclick="baixarRelatorioPDF()" class="btn btn-danger btn-sm me-2">Baixar PDF</button>
      <button onclick="baixarRelatorioExcel()" class="btn btn-success btn-sm">Baixar Excel</button>
    </div>
    <pre id="relatorio" class="mt-3"></pre>
  </div>
</div>

<!-- Relatório de refeições por período -->
<div class="card hidden" id="refeicoesCard">
  <div class="card-header">Relatório de refeições por período</div>
  <div class="card-body">
    <div class="mb-2 d-flex gap-2 flex-wrap">
      <div>
        <label for="dataRefInicio" class="form-label">De:</label>
        <input type="date" class="form-control" id="dataRefInicio">
      </div>
      <div>
        <label for="dataRefFim" class="form-label">Até:</label>
        <input type="date" class="form-control" id="dataRefFim">
      </div>
    </div>
    <button class="btn btn-success mb-2" onclick="gerarRelatorioRefeicoesPeriodo()">Gerar Relatório</button>
    <pre id="relatorioRefeicoesPeriodo" class="bg-light p-2 rounded"></pre>
    <a id="whatsappLinkRefeicoes" class="btn btn-outline-success" href="#" target="_blank" style="display: none;">Compartilhar via WhatsApp</a>
  </div>
</div>

<!-- Gerenciar usuários (apenas admin) -->
<div class="card hidden" id="gerenciarUsuariosCard">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>Gerenciar Usuários</span>
    <button class="btn btn-outline-primary btn-sm" onclick="abrirModalUsuarios()">Ver usuários</button>
  </div>
  <div class="card-body">
    <p>Gerencie permissões e exclusão de usuários cadastrados.</p>
  </div>
</div>

<!-- ...restante do arquivo igual ao da resposta anterior, omitido aqui por limitação de espaço -->
</body>
</html>